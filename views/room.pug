html
  head
    title= roomname
    script(src='/javascripts/socket.io.js')
    script(src='https://code.jquery.com/jquery-3.4.1.min.js')
  body
    h1 Welcome to room #{name}
    h2 Type Your name and enroll!
    input(id="name" autocomplete="off")
    button(onclick="enterRoom()") Send
    ul(id="pepole")
    button(onclick="Match()") MATCH

  script.
    let paths = window.location.pathname.split('/')
    let roomid = paths[paths.length-1]
    let auth = paths[paths.length-1]
    var socket = io();
    function enterRoom(e){
      socket.emit('enter-room',{name:$("#name").val(), roomid: roomid})
        console.log("enter-room emmited, roomId:"+roomid)
    }
    function getQueryVariable(variable) {
    var query = window.location.search.substring(1);
    var vars = query.split('&');
    for (var i = 0; i < vars.length; i++) {
        var pair = vars[i].split('=');
        if (decodeURIComponent(pair[0]) == variable) {
            return decodeURIComponent(pair[1]);
        }
    }
    console.log('Query variable %s not found', variable);
    }

    function Match(e){
       fetch('/room/'+roomid+"/match",{
                method:'POST',
              headers: {
            'Content-Type': 'application/json'
            // 'Content-Type': 'application/x-www-form-urlencoded',
          },
          body: JSON.stringify({ 
            auth:  getQueryVariable("auth")
            })
      })
        .then(response => {
          console.log(response)
          if(!response.ok){
            response.json().then(data => {
                alert(data.message)
                });
          } else{
        response.json()
          .then(data => {
          console.log(data)
        });
          }
        
        })
        
    }
    $(function () {
      socket.on('connect', () => {
        console.log("connected to socket")
        // make enter enabled
      });
      socket.on('matched',msg=>console.log(msg))
      socket.on('users',msg=>  {  
        console.log(msg)
          $("#pepole").html("")
        for(let member of Object.keys(msg)){
          $("#pepole").append($("<li></li>").html(msg[member].name))
        }
      })
      socket.on('disconnect_member',msg =>console.log("user disconnected",msg))

      socket.on('disconnect',()=>{
        // make enter disabled
      })
    });

